# Lab 2 - Using Jinja2 Templates

## Contents

- [Objective](#objective)
- [Prerequisites](#prerequisites)
- [Lab Steps](#lab-steps)
  - [Step 1: Create the Playbook Directory Structure](#step-1-create-the-playbook-directory-structure)
  - [Step 2: Create the Jinja2 Template](#step-2-create-the-jinja2-template)
  - [Step 3: Create the Ansible Playbook](#step-3-create-the-ansible-playbook)
  - [Step 4: Run the Playbook](#step-4-run-the-playbook)
  - [Step 5: Verify the Configuration File](#step-5-verify-the-configuration-file)
  - [Step 6: Generate different configuration file](#step-6-generate-different-configuration-file)
- [Conclusion](#conclusion)

## Objective

Create an Ansible playbook that uses a Jinja2 template to generate a configuration file. The template will include conditional statements and loops to demonstrate dynamic content generation based on variables.

## Prerequisites

Ansible installed on the control node.
Basic familiarity with YAML and Ansible playbook structure.

## Lab Steps

### Step 1: Create the Playbook Directory Structure

Create a directory structure for your playbook and templates.

```bash
mkdir -p ansible-jinja-lab/templates
cd ansible-jinja-lab
```

### Step 2: Create the Jinja2 Template

Create a Jinja2 template file named `myconfig.conf.j2`` in the templates directory.

```bash
touch templates/myconfig.conf.j2
```

Edit the `myconfig.conf.j2` file and add the following content:

```jinja
# My Configuration File
# Generated by Ansible

{% if enable_feature %}
# Feature is enabled
feature_option = true
{% endif %}

# Users List
{% for user in users %}
user_{{ loop.index }} = {{ user.name }}
{% if user.admin %}
# {{ user.name }} is an admin
user_{{ loop.index }}_role = admin
{% else %}
# {{ user.name }} is a regular user
user_{{ loop.index }}_role = user
{% endif %}
{% endfor %}
```

This template will generate a configuration file that:

- Enables a feature if enable_feature is true.
- Iterates over a list of users and assigns them roles based on their admin status.

### Step 3: Create the Ansible Playbook

Create a playbook named `configure.yml` add the following content:

```yaml
---
- name: Generate Configuration File Using a Jinja2 Template
  hosts: localhost
  vars:
    enable_feature: true
    users:
      - name: alice
        admin: true
      - name: bob
        admin: false
      - name: charlie
        admin: false
  tasks:
    - name: Template the Configuration File
      template:
        src: templates/myconfig.conf.j2
        dest: /tmp/myconfig.conf
```

This playbook defines two variables: enable_feature and users.

It has a single task that uses the template module to generate a configuration file from the Jinja2 template and places it in the /tmp directory on the managed nodes.

## Step 4: Run the Playbook

Execute the playbook against localhost.

```bash
ansible-playbook configure.yml
```

### Step 5: Verify the Configuration File

Go to `/tmp/ folder and check the contents of the generated configuration file:

```bash
cat /tmp/myconfig.conf
```

You should see the feature enabled and a list of users with their roles based on the template logic.

### Step 6: Generate different configuration file

Go to your playbook and change the values of the `enable_feature` and `users` variables and run the playbook again.

Navigate to generated file to check the differences.

## Conclusion

You've just created a hands-on lab for working with Jinja2 templates in Ansible.

This lab demonstrates how to use conditional statements and loops within a template to generate dynamic configuration files. You can expand on this lab by adding more complex logic, filters, and variables to the template as needed.
